const mongoose = require('mongoose');
mongoose.connect('mongodb://' + process.env.NOSQL_HOST + '/' + process.env.NOSQL_DB_NAME, {useNewUrlParser: true});
const Schema = mongoose.Schema;
const ObjectId = Schema.ObjectId;
 
const BlogPost = new Schema({
  author: ObjectId,
  title: String,
  body: String
});

const MyModel = mongoose.model('BlogPost', BlogPost);

// remove any document if exist
MyModel.find({ }, function (err, posts) {
    if (!err) {
        posts.forEach(post => {
            post.remove();
            post.save(function (err) {
                // do something
                if (err) {
                    console.log(err);
                }
            });
        });
    }
  });

// create dumy data
var post1 = new MyModel({
    title:"post1",
    body:"this is a post1"
});

post1.save(function (err) {
    if (err) {
        console.log("ERROR = ",err); 
    }
});

var post2 = new MyModel({
    title:"post2",
    body:"this is a post2"
});

post2.save(function (err) {
    if (err) {
        console.log("ERROR = ",err); 
    } 
});

module.exports = MyModel;